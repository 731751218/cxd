(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/testingPay/testingPay"],{"3e27":function(e,t,n){},8122:function(e,t,n){"use strict";n.r(t);var a=n("add1"),r=n.n(a);for(var i in a)"default"!==i&&function(e){n.d(t,e,function(){return a[e]})}(i);t["default"]=r.a},"82ed":function(e,t,n){"use strict";var a=n("3e27"),r=n.n(a);r.a},8952:function(e,t,n){"use strict";n.r(t);var a=n("9dd3"),r=n("8122");for(var i in r)"default"!==i&&function(e){n.d(t,e,function(){return r[e]})}(i);n("82ed");var s=n("2877"),o=Object(s["a"])(r["default"],a["a"],a["b"],!1,null,null,null);t["default"]=o.exports},"9dd3":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c},r=[];n.d(t,"a",function(){return a}),n.d(t,"b",function(){return r})},add1:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n("a34a")),r=i(n("f159"));function i(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,a,r,i,s){try{var o=e[i](s),u=o.value}catch(c){return void n(c)}o.done?t(u):Promise.resolve(u).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise(function(a,r){var i=e.apply(t,n);function o(e){s(i,a,r,o,u,"next",e)}function u(e){s(i,a,r,o,u,"throw",e)}o(void 0)})}}var u=function(){return n.e("components/lu-popup-wrapper/lu-popup-wrapper").then(n.bind(null,"0252"))},c=function(){return n.e("components/license-plate-key").then(n.bind(null,"1f92"))},d=function(){return Promise.all([n.e("common/vendor"),n.e("components/uni-calendar/uni-calendar")]).then(n.bind(null,"36da"))},l=function(){return n.e("components/an-layer/an-layer").then(n.bind(null,"da0f"))},p={components:{luPopupWrapper:u,uniCalendar:d,licensePlateKey:c,anLayer:l},data:function(){return{address:"",dataTime:"打开日历选择审车日期",msg:"",name:"",phone:"",carnumber:"",type:null,isaddress:!0,testing_id:null,price:"",settime:null}},methods:{onCalendar:function(){this.$refs.calendar.open()},calendar:function(e){console.log(e.fulldate),this.dataTime=e.fulldate},onMap:function(){var t=this;e.chooseLocation({success:function(e){t.address=e.address}})},pay:function(){var t=o(a.default.mark(function t(){var n,i,s,o,u,c,d,l,p,f,h,m,g,b,y,v,w,_,k=this;return a.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(wx.requestSubscribeMessage&&"{}"!=JSON.stringify(getApp().globalData.messageTemplateId)&&(console.log("开始订阅!!"),n=getApp().globalData.messageTemplateId.testing_message_template_id,wx.requestSubscribeMessage({tmplIds:[n],success:function(t){e.showToast({title:"订阅成功!",icon:"none",duration:2e3})}})),i=this.name,s=this.phone,o=this.dataTime,u=this.type,c=this.msg,d=this.testing_id,l=this.price,p=this.address,i=i.trim(),f=this.$refs.licensePlateKey.toBind(),!f){t.next=43;break}if(i.length){t.next=10;break}return e.showToast({title:"请输入联系人",icon:"none",duration:2e3}),t.abrupt("return",!1);case 10:if(/^1[3456789]\d{9}$/.test(s)){t.next=15;break}return e.showToast({title:"请输入有效的手机号",icon:"none",duration:2e3}),t.abrupt("return",!1);case 15:if("打开日历选择审车日期"!=o){t.next=18;break}return e.showToast({title:"请打开日历选择审车日期",icon:"none",duration:2e3}),t.abrupt("return",!1);case 18:if(1!=u){t.next=23;break}if(h=this.address.trim(),h.length){t.next=23;break}return e.showToast({title:"请填写详细的取车地址",icon:"none",duration:2e3}),t.abrupt("return",!1);case 23:return console.log("可以下单"),t.next=26,this.ajax(this.api.testingPay,{type:u,name:i,phone:s,carnumber:f,msg:c,testing_id:d,price:l,address:p,datatime:o},"POST");case 26:if(m=t.sent,m.data.data.order_id,200!=m.data.code){t.next=40;break}g=JSON.parse(m.data.data.payinfo),"FAIL"==g.return_code&&e.showModal({title:"提示",content:g.return_msg,showCancel:!1}),b=g.appid,y=parseFloat(g.timeStamp).toString(),v="prepay_id="+g.prepay_id,w=g.nonce_str,g.sign,_=r.default.MD5("appId="+b+"&nonceStr="+w+"&package="+v+"&signType=MD5&timeStamp="+y+"&key="+g.apikey),e.requestPayment({provider:"wxpay",timeStamp:y,nonceStr:w,package:v,signType:"MD5",paySign:_,success:function(t){k.$refs.anRef.show("支付成功！",{type:"success"}),k.settime=setTimeout(function(){e.reLaunch({url:"../testingOrder/testingOrder"})},1e3)},fail:function(e){k.$refs.anRef.show("支付失败！",{type:"error"})},complete:function(){e.hideLoading()}}),t.next=41;break;case 40:return t.abrupt("return",!1);case 41:t.next=44;break;case 43:e.showToast({title:"请输入车牌号",icon:"none",duration:2e3});case 44:case"end":return t.stop()}},t,this)}));function n(){return t.apply(this,arguments)}return n}()},onLoad:function(t){console.log(t),this.type=t.type;var n="";switch(t.type){case"1":n="代驾审车下单";break;case"2":n="预约审车下单",this.isaddress=!1;break}e.setNavigationBarTitle({title:n}),this.price=t.price,this.testing_id=t.testing_id},onUnload:function(){clearTimeout(this.settime)}};t.default=p}).call(this,n("543d")["default"])},c942:function(e,t,n){"use strict";(function(e){n("f103");a(n("66fd"));var t=a(n("8952"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])}},[["c942","common/runtime","common/vendor"]]]);